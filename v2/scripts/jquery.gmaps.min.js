(function(a){a.fn.gMap=function(d,c){switch(d){case'addMarker':return a(this).trigger('gMap.addMarker',[c.latitude,c.longitude,c.content,c.icon,c.popup]);case'centerAt':return a(this).trigger('gMap.centerAt',[c.latitude,c.longitude,c.zoom]);case'clearMarkers':return a(this).trigger('gMap.clearMarkers')}var b=a.extend({},a.fn.gMap.defaults,d);return this.each(function(){var c=new google.maps.Map(this),h,k,e,f,g,i,j,d,m,n,l;a(this).data('gMap.reference',c),h=new google.maps.Geocoder,b.address?h.geocode({address:b.address},function(a,b){a&&a.length&&c.setCenter(a[0].geometry.location)}):b.latitude&&b.longitude?c.setCenter(new google.maps.LatLng(b.latitude,b.longitude)):a.isArray(b.markers)&&b.markers.length>0?b.markers[0].address?h.geocode({address:b.markers[0].address},function(a,b){a&&a.length>0&&c.setCenter(a[0].geometry.location)}):c.setCenter(new google.maps.LatLng(b.markers[0].latitude,b.markers[0].longitude)):c.setCenter(new google.maps.LatLng(34.885931,9.84375)),c.setZoom(b.zoom),c.setMapTypeId(google.maps.MapTypeId[b.maptype]),k={scrollwheel:b.scrollwheel,disableDoubleClickZoom:!b.doubleclickzoom,styles:b.styles},b.controls===!1?a.extend(k,{disableDefaultUI:!0}):b.controls.length!==0&&a.extend(k,b.controls,{disableDefaultUI:!0}),c.setOptions(k),e=new google.maps.Marker,f=new google.maps.MarkerImage(b.icon.image),f.size=new google.maps.Size(b.icon.iconsize[0],b.icon.iconsize[1]),f.anchor=new google.maps.Point(b.icon.iconanchor[0],b.icon.iconanchor[1]),e.setIcon(f),b.icon.shadow&&(g=new google.maps.MarkerImage(b.icon.shadow),g.size=new google.maps.Size(b.icon.shadowsize[0],b.icon.shadowsize[1]),g.anchor=new google.maps.Point(b.icon.shadowanchor[0],b.icon.shadowanchor[1]),e.setShadow(g)),a(this).bind('gMap.centerAt',function(e,b,d,a){a&&c.setZoom(a),c.panTo(new google.maps.LatLng(parseFloat(b),parseFloat(d)))}),i=[],a(this).bind('gMap.clearMarkers',function(){while(i[0])i.pop().setMap(null)}),a(this).bind('gMap.addMarker',function(p,m,l,h,a,n){var o=new google.maps.LatLng(parseFloat(m),parseFloat(l)),d=new google.maps.Marker({position:o}),f,g,k;a?(f=new google.maps.MarkerImage(a.image),f.size=new google.maps.Size(a.iconsize[0],a.iconsize[1]),f.anchor=new google.maps.Point(a.iconanchor[0],a.iconanchor[1]),d.setIcon(f),a.shadow&&(g=new google.maps.MarkerImage(a.shadow),g.size=new google.maps.Size(a.shadowsize[0],a.shadowsize[1]),g.anchor=new google.maps.Point(a.shadowanchor[0],a.shadowanchor[1]),e.setShadow(g))):(d.setIcon(e.getIcon()),d.setShadow(e.getShadow())),h&&(h==='_latlng'&&(h=m+', '+l),k=new google.maps.InfoWindow({content:b.html_prepend+h+b.html_append}),google.maps.event.addListener(d,'click',function(){j&&j.close(),k.open(c,d),j=k}),n&&google.maps.event.addListenerOnce(c,'tilesloaded',function(){k.open(c,d)})),d.setMap(c),i.push(d)}),m=this,n=function(b){return function(c,d){c&&c.length>0&&a(m).trigger('gMap.addMarker',[c[0].geometry.location.lat(),c[0].geometry.location.lng(),b.html,b.icon,b.popup])}};for(l=0;l<b.markers.length;l++)d=b.markers[l],d.address?(d.html==='_address'&&(d.html=d.address),h.geocode({address:d.address},n(d))):a(this).trigger('gMap.addMarker',[d.latitude,d.longitude,d.html,d.icon,d.popup])})},a.fn.gMap.defaults={address:'',latitude:0,longitude:0,zoom:1,markers:[],controls:[],scrollwheel:!1,doubleclickzoom:!0,maptype:'ROADMAP',html_prepend:'<div class="gmap_marker">',html_append:'</div>',icon:{image:"http://www.google.com/mapfiles/marker.png",shadow:"http://www.google.com/mapfiles/shadow50.png",iconsize:[20,34],shadowsize:[37,34],iconanchor:[9,34],shadowanchor:[6,34]}}})(jQuery)