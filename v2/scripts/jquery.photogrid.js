/*!
 * jQuery photoGrid v1.0.0
 * Justified Grid like Flickr or Google+ and Google Imagesearch
 * by Marco Krage
 * MIT License (see http://marco.mit-license.org)
 */(function(a){a.fn.photoGrid=function(c){var b=a.extend({itemSelector:".item",resize:!0,rowHeight:a(window).height()/2,callback:function(){}},c);return _layout=function(j,n,h){var c=j.find(n).toArray(),f=j.width(),e=parseInt(b.rowHeight),k=c.reduce(function(a,b){return a+=aspect_ratio(b)*e},0),g=Math.round(k/f),d,i,l,m;g<1?(width=parseInt(e*aspect_ratio(c)),height=e,a(c).css({width:width-parseInt(a(c).css('marginLeft'))*2,height:height-parseInt(a(c).css('marginTop'))*2})):(l=c.map(function(a){return parseInt(aspect_ratio(a)*100)}),m=linear_partition(l,g),i=0,d=[],a.each(m,function(g,e){var b;return d=[],a.each(e,function(){return d.push(c[i++])}),b=d.reduce(function(a,b){return a+=aspect_ratio(b)},0),a.each(d,function(d,c){width=parseInt(f/b*aspect_ratio(c)),height=parseInt(f/b),a(c).css({width:width-parseInt(a(c).css('marginLeft'))*2,height:height-parseInt(a(c).css('marginTop'))*2})})})),h&&h()},aspect_ratio=function(b){return a(b).outerWidth(!0)/a(b).outerHeight(!0)},linear_partition=function(h,a){var s=Array.isArray,r=Array.prototype.forEach,d={},q=d.each=d.forEach=function(a,f,g){var b,c,e;if(a==null)return a;if(r&&a.forEach===r)a.forEach(f,g);else if(a.length===+a.length){for(b=0,c=a.length;b<c;b++)if(f.call(g,a[b],b,a)===breaker)return}else{e=d.keys(a);for(b=0,c=e.length;b<c;b++)if(f.call(g,a[e[b]],e[b],a)===breaker)return}return a},n,c,f,p,b,m,g,e,o,i,k,j,l;if(d.isArray=s||function(a){return toString.call(a)=='[object Array]'},d.max=function(a,c,i){var b=-(1/0),h=-(1/0),e,f,g,j;if(!c&&d.isArray(a)){for(g=0,j=a.length;g<j;g++)e=a[g],e>b&&(b=e)}else q(a,function(a,d,e){f=c?c.call(i,a,d,e):a,f>h&&(b=a,h=f)});return b},d.min=function(a,c,i){var b=1/0,h=1/0,e,f,g,j;if(!c&&d.isArray(a)){for(g=0,j=a.length;g<j;g++)e=a[g],e<b&&(b=e)}else q(a,function(a,d,e){f=c?c.call(i,a,d,e):a,f<h&&(b=a,h=f)});return b},b=h.length,a<=0)return[];if(a>b)return h.map(function(a){return[a]});g=function(){var c,d;d=[];for(o=c=0;0<=b?c<b:c>b;o=0<=b?++c:--c)d.push(function(){var b,c;c=[];for(e=b=0;0<=a?b<a:b>a;e=0<=a?++b:--b)c.push(0);return c}());return d}(),m=function(){var c,d,f;f=[];for(o=c=0,d=b-1;0<=d?c<d:c>d;o=0<=d?++c:--c)f.push(function(){var b,c,d;d=[];for(e=b=0,c=a-1;0<=c?b<c:b>c;e=0<=c?++b:--b)d.push(0);return d}());return f}();for(c=i=0;0<=b?i<b:i>b;c=0<=b?++i:--i)g[c][0]=h[c]+(c?g[c-1][0]:0);for(f=k=0;0<=a?k<a:k>a;f=0<=a?++k:--k)g[0][f]=h[0];for(c=j=1;1<=b?j<b:j>b;c=1<=b?++j:--j)for(f=l=1;1<=a?l<a:l>a;f=1<=a?++l:--l)p=d.min(function(){var a,b;b=[];for(e=a=0;0<=c?a<c:a>c;e=0<=c?++a:--a)b.push([d.max([g[e][f-1],g[c][0]-g[e][0]]),e]);return b}(),function(a){return a[0]}),g[c][f]=p[0],m[c-1][f-1]=p[1];for(b=b-1,a=a-2,n=[];a>=0;)n=[function(){var d,f,e,g;g=[];for(c=d=f=m[b-1][a]+1,e=b+1;f<=e?d<e:d>e;c=f<=e?++d:--d)g.push(h[c]);return g}()].concat(n),b=m[b-1][a],a=a-1;return[function(){var a,d,e;e=[];for(c=a=0,d=b+1;0<=d?a<d:a>d;c=0<=d?++a:--a)e.push(h[c]);return e}()].concat(n)},this.each(function(){if($container=a(this),_layout($container,b.itemSelector,b.callback),b.resize){var c;function d(){_layout($container,b.itemSelector)}a(window).resize(function(){clearTimeout(c),c=setTimeout(d,250)})}})}})(jQuery),function(){function b(){}function d(b,c){for(var a=b.length;a--;)if(b[a].listener===c)return a;return-1}function c(a){return function(){return this[a].apply(this,arguments)}}var a=b.prototype,e=this,f=e.EventEmitter;a.getListeners=function(c){var d,a,b=this._getEvents();if("object"==typeof c){d={};for(a in b)b.hasOwnProperty(a)&&c.test(a)&&(d[a]=b[a])}else d=b[c]||(b[c]=[]);return d},a.flattenListeners=function(b){var a,c=[];for(a=0;b.length>a;a+=1)c.push(b[a].listener);return c},a.getListenersAsObject=function(c){var a,b=this.getListeners(c);return b instanceof Array&&(a={},a[c]=b),a||b},a.addListener=function(e,a){var b,c=this.getListenersAsObject(e),f="object"==typeof a;for(b in c)c.hasOwnProperty(b)&&-1===d(c[b],a)&&c[b].push(f?a:{listener:a,once:!1});return this},a.on=c("addListener"),a.addOnceListener=function(a,b){return this.addListener(a,{listener:b,once:!0})},a.once=c("addOnceListener"),a.defineEvent=function(a){return this.getListeners(a),this},a.defineEvents=function(b){for(var a=0;b.length>a;a+=1)this.defineEvent(b[a]);return this},a.removeListener=function(e,f){var c,a,b=this.getListenersAsObject(e);for(a in b)b.hasOwnProperty(a)&&(c=d(b[a],f),-1!==c&&b[a].splice(c,1));return this},a.off=c("removeListener"),a.addListeners=function(a,b){return this.manipulateListeners(!1,a,b)},a.removeListeners=function(a,b){return this.manipulateListeners(!0,a,b)},a.manipulateListeners=function(d,b,e){var a,c,f=d?this.removeListener:this.addListener,g=d?this.removeListeners:this.addListeners;if("object"!=typeof b||b instanceof RegExp)for(a=e.length;a--;)f.call(this,b,e[a]);else for(a in b)b.hasOwnProperty(a)&&(c=b[a])&&("function"==typeof c?f.call(this,a,c):g.call(this,a,c));return this},a.removeEvent=function(c){var a,d=typeof c,b=this._getEvents();if("string"===d)delete b[c];else if("object"===d)for(a in b)b.hasOwnProperty(a)&&c.test(a)&&delete b[a];else delete this._events;return this},a.removeAllListeners=c("removeEvent"),a.emitEvent=function(e,g){var a,d,c,f,b=this.getListenersAsObject(e);for(c in b)if(b.hasOwnProperty(c))for(d=b[c].length;d--;)a=b[c][d],a.once===!0&&this.removeListener(e,a.listener),f=a.listener.apply(this,g||[]),f===this._getOnceReturnValue()&&this.removeListener(e,a.listener);return this},a.trigger=c("emitEvent"),a.emit=function(a){var b=Array.prototype.slice.call(arguments,1);return this.emitEvent(a,b)},a.setOnceReturnValue=function(a){return this._onceReturnValue=a,this},a._getOnceReturnValue=function(){return!this.hasOwnProperty("_onceReturnValue")||this._onceReturnValue},a._getEvents=function(){return this._events||(this._events={})},b.noConflict=function(){return e.EventEmitter=f,b},"function"==typeof define&&define.amd?define("eventEmitter/EventEmitter",[],function(){return b}):"object"==typeof module&&module.exports?module.exports=b:this.EventEmitter=b}.call(this),function(e){var a,b,c,d;function f(b){var a=e.event;return a.target=a.target||a.srcElement||b,a}a=document.documentElement,b=function(){},a.addEventListener?b=function(a,b,c){a.addEventListener(b,c,!1)}:a.attachEvent&&(b=function(a,c,b){a[c+b]=b.handleEvent?function(){var c=f(a);b.handleEvent.call(b,c)}:function(){var c=f(a);b.call(a,c)},a.attachEvent("on"+c,a[c+b])}),c=function(){},a.removeEventListener?c=function(a,b,c){a.removeEventListener(b,c,!1)}:a.detachEvent&&(c=function(a,b,c){a.detachEvent("on"+b,a[b+c]);try{delete a[b+c]}catch(d){a[b+c]=void 0}}),d={bind:b,unbind:c},"function"==typeof define&&define.amd?define("eventie/eventie",d):e.eventie=d}(this),function(a,b){"function"==typeof define&&define.amd?define(["eventEmitter/EventEmitter","eventie/eventie"],function(c,d){return b(a,c,d)}):"object"==typeof exports?module.exports=b(a,require("wolfy87-eventemitter"),require("eventie")):a.imagesLoaded=b(a,a.EventEmitter,a.eventie)}(window,function(l,f,d){var c,g,j,k,h;function i(a,b){for(var c in b)a[c]=b[c];return a}function n(a){return"[object Array]"===k.call(a)}function m(a){var b=[],c,d;if(n(a))b=a;else if("number"==typeof a.length)for(c=0,d=a.length;d>c;c++)b.push(a[c]);else b.push(a);return b}function a(b,d,e){if(!(this instanceof a))return new a(b,d);"string"==typeof b&&(b=document.querySelectorAll(b)),this.elements=m(b),this.options=i({},this.options),"function"==typeof d?e=d:i(this.options,d),e&&this.on("always",e),this.getImages(),c&&(this.jqDeferred=new c.Deferred);var f=this;setTimeout(function(){f.check()})}function e(a){this.img=a}function b(a){this.src=a,h[a]=this}return c=l.jQuery,g=l.console,j=g!==void 0,k=Object.prototype.toString,a.prototype=new f,a.prototype.options={},a.prototype.getImages=function(){var c,f,a,b,e,d,g,h;this.images=[];for(c=0,f=this.elements.length;f>c;c++)if(a=this.elements[c],"IMG"===a.nodeName&&this.addImage(a),b=a.nodeType,b&&(1===b||9===b||11===b))for(e=a.querySelectorAll("img"),d=0,g=e.length;g>d;d++)h=e[d],this.addImage(h)},a.prototype.addImage=function(a){var b=new e(a);this.images.push(b)},a.prototype.check=function(){var a,d,b,c,e;function f(c,e){return a.options.debug&&j&&g.log("confirm",c,e),a.progress(c),d++,d===b&&a.complete(),!0}if(a=this,d=0,b=this.images.length,this.hasAnyBroken=!1,!b)return this.complete(),void 0;for(c=0;b>c;c++)e=this.images[c],e.on("confirm",f),e.check()},a.prototype.progress=function(b){this.hasAnyBroken=this.hasAnyBroken||!b.isLoaded;var a=this;setTimeout(function(){a.emit("progress",a,b),a.jqDeferred&&a.jqDeferred.notify&&a.jqDeferred.notify(a,b)})},a.prototype.complete=function(){var b=this.hasAnyBroken?"fail":"done",a;this.isComplete=!0,a=this,setTimeout(function(){if(a.emit(b,a),a.emit("always",a),a.jqDeferred){var c=a.hasAnyBroken?"reject":"resolve";a.jqDeferred[c](a)}})},c&&(c.fn.imagesLoaded=function(b,d){var e=new a(this,b,d);return e.jqDeferred.promise(c(this))}),e.prototype=new f,e.prototype.check=function(){var a=h[this.img.src]||new b(this.img.src),c;if(a.isConfirmed)return this.confirm(a.isLoaded,"cached was confirmed"),void 0;if(this.img.complete&&void 0!==this.img.naturalWidth)return this.confirm(0!==this.img.naturalWidth,"naturalWidth"),void 0;c=this,a.on("confirm",function(a,b){return c.confirm(a.isLoaded,b),!0}),a.check()},e.prototype.confirm=function(a,b){this.isLoaded=a,this.emit("confirm",this,b)},h={},b.prototype=new f,b.prototype.check=function(){if(!this.isChecked){var a=new Image;d.bind(a,"load",this),d.bind(a,"error",this),a.src=this.src,this.isChecked=!0}},b.prototype.handleEvent=function(a){var b="on"+a.type;this[b]&&this[b](a)},b.prototype.onload=function(a){this.confirm(!0,"onload"),this.unbindProxyEvents(a)},b.prototype.onerror=function(a){this.confirm(!1,"onerror"),this.unbindProxyEvents(a)},b.prototype.confirm=function(a,b){this.isConfirmed=!0,this.isLoaded=a,this.emit("confirm",this,b)},b.prototype.unbindProxyEvents=function(a){d.unbind(a.target,"load",this),d.unbind(a.target,"error",this)},a})